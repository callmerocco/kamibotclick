<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link is Ready - LinkSwift</title>
    <script src="https://cdn.tailwindcss.com"></script>
    </head>
<body class="bg-[#f8fafc] text-slate-900 min-h-screen flex flex-col items-center">

    <div class="w-full bg-white border-b border-slate-200 p-4 flex justify-center overflow-hidden">
        <div class="flex flex-col items-center">
            <script>
  atOptions = {
    'key' : '448e404a0e501735472e96bd763fedc3',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/448e404a0e501735472e96bd763fedc3/invoke.js"></script>
        </div>
    </div>

    <div class="flex-1 flex flex-col items-center justify-center w-full px-6">
        <div id="loader" class="text-center animate-pulse">
            <p class="text-slate-400">Verifying link...</p>
        </div>

        <div id="ad-container" class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-md w-full text-center border border-slate-100 hidden">
            <h2 id="msg" class="text-xl font-bold text-slate-800 mb-8 italic">Your link is being prepared...</h2>
            
            <div class="relative w-32 h-32 mx-auto mb-10">
                <svg class="w-full h-full transform -rotate-90">
                    <circle cx="64" cy="64" r="60" stroke="#e2e8f0" stroke-width="8" fill="transparent"/>
                    <circle id="bar" cx="64" cy="64" r="60" stroke="#3b82f6" stroke-width="8" fill="transparent" 
                            stroke-dasharray="377" stroke-dashoffset="0" class="transition-all duration-1000 ease-linear"/>
                </svg>
                <div id="timer" class="absolute inset-0 flex items-center justify-center text-4xl font-black text-slate-800">10</div>
            </div>

            <button id="getBtn" disabled 
                    class="w-full bg-slate-200 text-slate-400 py-4 rounded-2xl font-black uppercase tracking-widest transition-all cursor-not-allowed">
                Please Wait...
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
const pathSegments = window.location.pathname.split('/');
const id = pathSegments.filter(segment => segment !== '' && segment !== 'go').pop();

console.log("Detected ID:", id); // Check this in F12 console

        const firebaseConfig = { 
            apiKey: "AIzaSyAuTU6BV_uxz56NYiJioV2NJ7Wk_wMhL0g",
            authDomain: "kamibotclick.firebaseapp.com",
            projectId: "kamibotclick",
            storageBucket: "kamibotclick.firebasestorage.app",
            messagingSenderId: "112587834193",
            appId: "1:112587834193:web:c3fb8e45f24b874edf8970" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const safeSites = [
            "https://www.wikipedia.org",
            "https://www.google.com",
            "https://www.youtube.com",
            "https://www.nasa.gov"
        ];

        const pathSegments = window.location.pathname.split('/');
        const id = pathSegments.pop() || pathSegments.pop(); // Handles trailing slashes

        async function load() {
            let targetUrl = "";

            // Attempt to find link in Firebase if ID is valid
            if (id && id !== "go" && id !== "go.html" && id !== "") {
                try {
                    const snap = await getDoc(doc(db, "links", id));
                    if (snap.exists()) {
                        targetUrl = snap.data().target;
                    }
                } catch (e) {
                    console.error("Database error:", e);
                }
            }

            // Fallback if no ID or link not found
            if (!targetUrl) {
                targetUrl = safeSites[Math.floor(Math.random() * safeSites.length)];
                document.getElementById('msg').innerText = "Redirecting to a safe link...";
            }

            document.getElementById('loader').classList.add('hidden');
            document.getElementById('ad-container').classList.remove('hidden');
            runTimer(targetUrl);
        }

        function runTimer(target) {
            let time = 10;
            const bar = document.getElementById('bar');
            const btn = document.getElementById('getBtn');
            const timerText = document.getElementById('timer');
            
            const itv = setInterval(() => {
                time--;
                timerText.innerText = time;
                bar.style.strokeDashoffset = 377 - (377 * (10 - time) / 10);
                
                if(time <= 0){
                    clearInterval(itv);
                    document.getElementById('msg').innerText = "Ready to go!";
                    btn.disabled = false;
                    btn.classList.replace('bg-slate-200', 'bg-blue-600');
                    btn.classList.replace('text-slate-400', 'text-white');
                    btn.classList.remove('cursor-not-allowed');
                    btn.innerText = "Get Link";
                    
                    btn.onclick = () => {
                        // REPLACE THIS WITH YOUR ADSTERRA DIRECT LINK
                        window.open('https://www.google.com', '_blank'); 
                        window.location.href = target;
                    };
                }
            }, 1000);
        }

        load();
    </script>
</body>
</html>
